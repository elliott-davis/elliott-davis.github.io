<!doctype html><html lang=en><head><title>Llm_bot :: TireFire.dev</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction In the world of chatbots, natural language processing (NLP) has taken center stage, and Hugging Face Transformers has emerged as a powerful toolkit for working with NLP models. Slack, a popular team collaboration platform, offers a great environment for deploying custom bots to enhance communication within your workspace. In this blog post, I&amp;rsquo;ll walk you through the process of creating a Slack bot powered by Hugging Face Transformers. By the end, you&amp;rsquo;ll have a conversational bot capable of performing various NLP tasks right in your Slack channels."><meta name=keywords content="llm,slack"><meta name=robots content="noodp"><link rel=canonical href=/posts/llm_bot/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/blue.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/favicon.ico><meta name=twitter:card content="summary"><meta name=twitter:site content="https://tirefire.dev"><meta name=twitter:creator content="Elliott Davis"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Llm_bot"><meta property="og:description" content="Introduction In the world of chatbots, natural language processing (NLP) has taken center stage, and Hugging Face Transformers has emerged as a powerful toolkit for working with NLP models. Slack, a popular team collaboration platform, offers a great environment for deploying custom bots to enhance communication within your workspace. In this blog post, I&amp;rsquo;ll walk you through the process of creating a Slack bot powered by Hugging Face Transformers. By the end, you&amp;rsquo;ll have a conversational bot capable of performing various NLP tasks right in your Slack channels."><meta property="og:url" content="/posts/llm_bot/"><meta property="og:site_name" content="TireFire.dev"><meta property="og:image" content="/images/robot_finger.gif"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2023-11-08 20:36:14 -0600 -0600"></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>TireFire.dev</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/posts/llm_bot/>Llm_bot</a></h1><div class=post-meta><span class=post-date>2023-11-08
</span><span class=post-author>:: Elliott Davis</span></div><span class=post-tags>#<a href=/tags/llm/>llm</a>&nbsp;
</span><img src=/images/robot_finger.gif class=post-cover alt=Llm_bot title="Cover Image"><div class=post-content><div><h1 id=introduction>Introduction<a href=#introduction class=hanchor arialabel=Anchor>&#8983;</a></h1><p>In the world of chatbots, natural language processing (NLP) has taken center stage, and Hugging Face Transformers has emerged as a powerful toolkit for working with NLP models. Slack, a popular team collaboration platform, offers a great environment for deploying custom bots to enhance communication within your workspace. In this blog post, I&rsquo;ll walk you through the process of creating a Slack bot powered by Hugging Face Transformers. By the end, you&rsquo;ll have a conversational bot capable of performing various NLP tasks right in your Slack channels.</p><h1 id=prerequisites>Prerequisites<a href=#prerequisites class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Before we dive into the development process, let&rsquo;s make sure we have the necessary tools and accounts set up:</p><p>Slack Account: You need an active Slack account to create and deploy your bot within your workspace.</p><p>Dependencies: Install the dependencies required by cloning <a href=https://github.com/elliott-davis/slack_thread_summarizer>https://github.com/elliott-davis/slack_thread_summarizer</a> and running <code>pip install -r ./requirements.txt</code>.</p><p>Bot Token: To create a Slack bot, you&rsquo;ll need to set up a Slack App and generate a bot token. This token will enable your bot to interact with your Slack workspace.</p><h1 id=setting-up-your-slack-bot>Setting Up Your Slack Bot<a href=#setting-up-your-slack-bot class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Create a Slack App:</p><p>Go to the Slack API and click on &ldquo;Create an App.&rdquo;
Give your app a name, select your workspace, and click &ldquo;Create App.&rdquo;
Enable OAuth & Permissions:</p><p>In your app settings, navigate to &ldquo;OAuth & Permissions.&rdquo;
Add the following Bot Token Scopes:</p><ul><li>app_mentions:read</li><li>channels:history</li><li>channels:join</li><li>channels:read</li><li>chat:write</li><li>commands</li><li>groups:history</li><li>im:history</li><li>mpim:history</li><li>users:read</li><li>commands
Save your changes.
Install Your App to Workspace:</li></ul><p>In your app settings, go to &ldquo;Install App&rdquo; and click the &ldquo;Install to Workspace&rdquo; button.
Follow the prompts to grant permissions to your bot in your workspace.
Note the Bot Token:</p><p>In your app settings, go to &ldquo;OAuth & Permissions&rdquo; and copy the Bot User OAuth Token. You&rsquo;ll need this token to authenticate your bot.</p><h1 id=building-the-slack-bot>Building the Slack Bot<a href=#building-the-slack-bot class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Now that you have your Slack bot set up, let&rsquo;s create a Python script that uses Hugging Face Transformers to power your bot.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> haystack.nodes <span style=color:#f92672>import</span> TransformersSummarizer
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> haystack <span style=color:#f92672>import</span> Document
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> slack_bolt <span style=color:#f92672>import</span> App
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> slack_bolt.adapter.socket_mode <span style=color:#f92672>import</span> SocketModeHandler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> App(
</span></span><span style=display:flex><span>    token<span style=color:#f92672>=</span>os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;SLACK_BOT_TOKEN&#34;</span>),
</span></span><span style=display:flex><span>    signing_secret<span style=color:#f92672>=</span>os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;SLACK_SIGNING_SECRET&#34;</span>)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>summarizer <span style=color:#f92672>=</span> TransformersSummarizer(
</span></span><span style=display:flex><span>    model_name_or_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;philschmid/flan-t5-base-samsum&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name_db <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Cache the user ID&#39;s and real names from the thread so we don&#39;t blow past our rate limit</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_real_name</span>(client, id: str) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> id <span style=color:#f92672>in</span> name_db:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> name_db[id]
</span></span><span style=display:flex><span>    real_name <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>users_info(user<span style=color:#f92672>=</span>id)[<span style=color:#e6db74>&#34;user&#34;</span>][<span style=color:#e6db74>&#34;real_name&#34;</span>]
</span></span><span style=display:flex><span>    name_db[id] <span style=color:#f92672>=</span> real_name
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> real_name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.event</span>(<span style=color:#e6db74>&#34;app_mention&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>summarize_thread</span>(client, event, say):
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    thread_ts <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;thread_ts&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> thread_ts <span style=color:#f92672>is</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        say(<span style=color:#e6db74>&#34;Sorry, I can only summarize threads&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    channel_id <span style=color:#f92672>=</span> event<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;channel&#34;</span>, <span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>conversations_replies(channel<span style=color:#f92672>=</span>channel_id, ts<span style=color:#f92672>=</span>thread_ts)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> result[<span style=color:#e6db74>&#34;ok&#34;</span>]:
</span></span><span style=display:flex><span>        say(<span style=color:#e6db74>&#34;failed to get thread text. Try again later&#34;</span>, thread_ts<span style=color:#f92672>=</span>thread_ts)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Combine the content of the thread into a single document formatted like:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Elliott Davis: And he said whaaaaa</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Matt Dresser: Nooooo</span>
</span></span><span style=display:flex><span>    conversation <span style=color:#f92672>=</span> Document(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(get_real_name(
</span></span><span style=display:flex><span>        client, message[<span style=color:#e6db74>&#34;user&#34;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> message[<span style=color:#e6db74>&#34;text&#34;</span>] <span style=color:#66d9ef>for</span> message <span style=color:#f92672>in</span> result[<span style=color:#e6db74>&#34;messages&#34;</span>][:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span>    summary <span style=color:#f92672>=</span> summarizer<span style=color:#f92672>.</span>predict(documents<span style=color:#f92672>=</span>[conversation])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    say(text<span style=color:#f92672>=</span>summary[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>meta[<span style=color:#e6db74>&#34;summary&#34;</span>], thread_ts<span style=color:#f92672>=</span>thread_ts)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Used in dev mode since work blocks ngrok</span>
</span></span><span style=display:flex><span>    SocketModeHandler(app, os<span style=color:#f92672>.</span>environ[<span style=color:#e6db74>&#34;SLACK_APP_TOKEN&#34;</span>])<span style=color:#f92672>.</span>start()
</span></span></code></pre></div><p>In this script, I leverage the slack API to ensure that we are in a thread, then read all messages in that thread into a single string. This string is precisely formatted to match the models training data from the samsum dataset. After formatting the text, we can feed it into the transformer model to make a prediction on the summarized text and return it to slack.</p><h1 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Creating a Slack bot powered by Hugging Face Transformers and haystack can greatly enhance communication and productivity in your workspace. With the capabilities of NLP at your bot&rsquo;s disposal, you can automate tasks, answer questions, and assist your team in various ways. By following the steps outlined in this blog post, you can bring your NLP-powered Slack bot to life and make your workspace even more dynamic and interactive.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/posts/storming-forming-norming/><span class=button__text>Storming, Forming and Norming</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>